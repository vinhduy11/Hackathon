<html>
<head>
    <title>Card Type Page title</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="../css/mask.css" rel="stylesheet" type="text/css"/>
    <link href="../css/mycss.css" rel="stylesheet" type="text/css"/>
    <script src="../js/jquery.1.9.js"></script>
    <script src="../js/session.js"></script>
    <script src="../js/cookie.js"></script>
    <script type="text/javascript" src="../js/mask.js"></script>
    <script type="text/javascript" src="../js/myjs.js"></script>

</head>
<body>
<div id="mydiv">
    <h2>Card Type Page</h2>

    <div style="float:left">
        <!--<b>Partner Code</b>: <input type="text" style="border:1px solid #778899; width:150px" name="sServiceId" id="sServiceId">-->
        <b>Partner Code</b>: <input type="text" style="border:1px solid #778899; width:150px" name="sPartnerCode"
                                    id="sPartnerCodeId">
        <b>Card Type:
            <select id="txtCardTypeSearch" name="txtCardType" style="width: 150px; font-size:14px; padding: 3px">
                <option value="">All</option>
                <option value="001">Visa</option>
                <option value="002">Master Card</option>
                <option value="003">American Express</option>
                <option value="004">Discover</option>
                <option value="005">Diners Club</option>
                <option value="006">Carte Blanche</option>
                <option value="007">Jcb</option>
                <option value="014">Enroute</option>
                <option value="021">Jal</option>
                <option value="031">Delta</option>
                <option value="033">Visa Electron</option>
                <option value="034">Dankort</option>
                <option value="036">Carte Bleue</option>
                <option value="037">Carta Si</option>
                <option value="024">Maestro Uk Domestic</option>
                <option value="042">Maestro International</option>
                <option value="043">Ge Money Uk Card</option>
            </select>
        </b>
        <b>Enable:
            <select id="f_enable">
                <option value="">All</option>
                <option value="true">Enabled</option>
                <option value="false">Disabled</option>
            </select>
        </b>
        <input type="button" id="btnSearch" value="Search">
    </div>
    <div class="clear"></div>

    <div id="table"></div>

    <div class="clear"></div>

    <div>
        <table>
            <tr>
                <th colspan="2">Edit Information</th>
            </tr>

            <tr>
                <td>Partner Code</td>
                <td><input style="border: none" type="text" id="txtPartnerCode">
                </td>
            </tr>

            <tr>
                <td>Card Type</td>
                <td>
                    <select id="txtCardType" name="txtCardType" style="width: 150px; font-size:14px; padding: 3px">
                        <option value="001">Visa</option>
                        <option value="002">Master Card</option>
                        <option value="003">American Express</option>
                        <option value="004">Discover</option>
                        <option value="005">Diners Club</option>
                        <option value="006">Carte Blanche</option>
                        <option value="007">Jcb</option>
                        <option value="014">Enroute</option>
                        <option value="021">Jal</option>
                        <option value="031">Delta</option>
                        <option value="033">Visa Electron</option>
                        <option value="034">Dankort</option>
                        <option value="036">Carte Bleue</option>
                        <option value="037">Carta Si</option>
                        <option value="024">Maestro Uk Domestic</option>
                        <option value="042">Maestro International</option>
                        <option value="043">Ge Money Uk Card</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td>Icon URL</td>
                <td><input style="border: none" type="text" id="txtIconUrl"></td>
            </tr>

            <tr>
                <td>Description</td>
                <td><input style="border: none" type="text" id="txtDesc"></td>
            </tr>

            <tr>
                <td>Enable</td>
                <td>
                    <select id="isEnable" name="isEnable" style="width: 150px; font-size:14px; padding: 3px">
                        <option value="true">Enabled</option>
                        <option value="false">Disabled</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td colspan="2" align="center">
                    <input type="hidden" id="txtId">
                    <input type="button" value="Update" id="btSave">
                </td>
            </tr>

        </table>
    </div>

</div>
<script type="text/javascript">
    
    $('#btSave').click(function () {
        upsert();
    });

    $(document).ready(function () {
        init();
    });

    $('#btnSearch').click(function () {
        init();
    });

    function upsert() {
        if ($.session.get("id") == null) {
            alert("Bạn phải đăng nhập.");
            $.session.clear();
            window.parent.location.href = "../html/login.html";
        } else {
            $('#mydiv').mask("Loading...");
            $.ajax({
                url: "/cardtype/upsert",
                type: "GET",
                data: {
                    id          :$("#txtId").val(),
                    partnerCode :$("#txtPartnerCode").val(),
                    cardType    :$("#txtCardType").val(),
                    desc        :$("#txtDesc").val(),
                    icon        :$("#txtIconUrl").val(),
                    enable      :$("#isEnable").val()
                },
                success: function (result) {
                    $('#mydiv').unmask();
                    var error = result.error;
                    if (error == 0) {
                        alert("Thành công.");
                        resetForm();
                        init();
                    }
                    else if (error == -1) {
                        alert("Bạn phải đăng nhập.");
                        $.session.clear();
                        window.parent.location.href = "../html/login.html";
                    }
                    else
                        alert("Không thành công. Error code = " + error);
                },
                error: function () {
                    $('#mydiv').unmask();
                    alert('Có lỗi kết nối xảy ra');
                }
            });
        }
    }

function resetForm(){
    $("#txtId").val("");
    $("#txtPartnerCode").val("");
    $("#txtCardType").val("");
    $("#txtDesc").val("");
    $("#txtIconUrl").val("");
    $("#isEnable").val("false");
}
function clearTable() {
        var head = "<tr>";
        head += "<th></th>";
        head += "<th>Partner Code</th>";
        head += "<th>Card Type</th>";
        head += "<th>Desc</th>";
        head += "<th>Image</th>";
        head += "<th>Icon</th>";
        head += "<th>Last Time</th>";
        head += "<th>Enable</th>";
        head +="</tr>";
        $("#table").html(head);
    }

    function addItem(item) {
        var row;
        row = "<tr>"
        var editButton = "<button id='" + item._id + "'>Edit</button>";
        row += "<td> " + editButton + " </td>";
        row += "<td> " + item.pcode + " </td>";
        row += "<td> " + item.cardType + " </td>";
        row += "<td> " + item.desc + " </td>";
        row += "<td> <image style='max-height: 30px;max-width: 30px;' src='" + item.iconUrl + "'></td>";
        row += "<td> " + item.iconUrl + " </td>";
        row += "<td> " + item.ltime + " </td>";
        row += "<td> " + item.enable + " </td>";
        row += "</tr>";

        $("#table").append(row);
        $("#" + item._id).click(function () {
            fillForm(item);
        });
    }

    function fillForm(item) {
        $("#txtId").val(item._id);
        $("#txtPartnerCode").val(item.pcode);
        $("#txtCardType").val(item.cardType);
        $("#txtDesc").val(item.desc);
        $("#txtIconUrl").val(item.iconUrl);
        $("#isEnable").val(item.enable +"");
    }

    function init() {
         $.ajax({
            url: "/cardtype/getAllCardTypes",
            type: "GET",
            data: {
                partnerCode: $("#sPartnerCodeId").val(),
                cardType: $("#txtCardTypeSearch").val(),
                enable: $("#f_enable").val()
            },
            success: function (array) {
                clearTable();
                for(i=0;i<array.length; i++){
                    addItem(array[i])
                }
            },
            error: function () {
                alert('Có lỗi kết nối xảy ra');
            }
        });
    }

</script>

</body>
</html>