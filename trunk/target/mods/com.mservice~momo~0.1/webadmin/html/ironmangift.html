<!DOCTYPE html>
<html>
<head>
    <title>Cau hinh gift</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="../css/mask.css" rel="stylesheet" type="text/css"/>
    <link href="../css/mycss.css" rel="stylesheet" type="text/css"/>
    <script src="../js/jquery.1.9.js"></script>
    <!--<script src="../js/session.js"></script>-->
    <!--<script src="../js/cookie_OLD.js"></script>-->
    <script type="text/javascript" src="../js/mask.js"></script>
    <link rel="stylesheet" href="../css/jquery.datetimepicker.css" type="text/css"/>
    <script src="../js/jquery.datetimepicker.js"></script>
</head>
<body>

<div>
    <h2>Cau hinh gift</h2>
    <hr />
    <table id="table">
    </table>
    <hr />
</div>
<hr />
<table>

    <tr>
        <td>Group:</td>
        <td><input type="text" id="group"/></td>
    </tr>
    <tr>
        <td>Qua fixed:</td>
        <td><input type="text" id="fixed_gift" /></td>
    </tr>
    <tr>
        <td>Qua random:</td>
        <td><input type="text" id="random_gift"/></td>
    </tr>

    <tr>
        <td>So luong qua cho moi group:</td>
        <td><input type="text" id="number_of_gift"/></td>
    </tr>

    <tr>
        <td></td>
        <td>
            <button id="btnClear">Clear</button>
            <button id="btnSave">Save</button>
            <button id="btnRefresh">Refresh</button>
        </td>
    </tr>
</table>

<script type="text/javascript">

    function clearTable() {
        var head = "<tr>";
        head += "<th>*</th>";
        head += "<th>Group</th>";
        head += "<th>Qua co dinh</th>";
        head += "<th>Qua random</th>";
        head += "<th>So luong qua cua moi group</th>";
        head += "</tr>";
        $("#table").html(head);
    }

    function addItem(item) {
        var row;
        var editButton = "<button id='edit_" + item._id + "'>Edit</button>";

        row = "<tr id='r_" + item._id + "'>";
        row += "<td> " + editButton + " </td>";
        row += "<td> " + item._id + " </td>";
        row += "<td> " + item.fixed_gift + " </td>";
        row += "<td> " + item.random_gift + " </td>";
        row += "<td> " + item.number_of_gift + " </td>";
        row += "</tr>";

        $("#table").append(row);

        $("#edit_" + item._id).click(function () {
            setFormValues(item);
        });
    }

    function setFormValues(item) {
        $("#group").val(item._id);
        $("#fixed_gift").val(item.fixed_gift);
        $("#random_gift").val(item.random_gift);
        $("#number_of_gift").val(item.number_of_gift);
    }

    function loadPage() {
        clearTable();
        var mUrl = "/service/ironman/getrandomgift";
        $.getJSON(mUrl).done(function (data) {
            $.each(data, function (i, item) {
                addItem(item);
            });
        });
    }
    $(document).ready(function () {
        loadPage();

        $("#btnSave").click(function () {
            $.ajax({
                url: "/service/ironman/updaterandomgift",
                type: "GET",
                enctype: "multipart/form-data",
                data: {
                    group :$("#group").val(),
                    fixed_gifts:$("#fixed_gift").val(),
                    random_gifts:$("#random_gift").val(),
                    number_of_gift :$("#number_of_gift").val()
                },
                success: function (result) {
                    var error = result.error;
                    if (error == 0) {
                        alert("Thành công.");
                        loadPage()
                    }
                    else
                        alert(result.desc);
                },
                error: function () {
                    alert('Có lỗi kết nối xảy ra');
                }
            });
        });
        $("#btnRefresh").click(function () {
            $.ajax({
                url: "/service/ironman/refreshgift",
                type: "GET",
                enctype: "multipart/form-data",
                data: {
                },
                success: function (result) {
                    var error = result.error;
                    if (error == 0) {
                        alert("Thành công.");
                        loadPage()
                    }
                    else
                        alert("That bai");
                },
                error: function () {
                    alert('Có lỗi kết nối xảy ra');
                }
            });
        });
    });
</script>
</body>
</html>