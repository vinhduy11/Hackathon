<html>
<head>
    <title>Adjust Page</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="../css/mask.css" rel="stylesheet" type="text/css" />
    <link href="../css/mycss.css" rel="stylesheet" type="text/css"/>
    <script src="../js/jquery.1.9.js"></script>
    <script src="../js/session.js"></script>
    <script src="../js/cookie.js"></script>
    <script type="text/javascript" src="../js/mask.js"></script>
</head>
<body>
<div id="mydiv">
    <h2>Adjust Page</h2>


    <table id="inputform">
        <tr>
            <td>Source Agent:</td>
            <td><input style="width: 400px; font-size:16px; padding: 3px" type="text" id="sid"/></td>
        </tr>
        <tr>
            <td>Destination Agent:</td>
            <td><input style="width: 400px; font-size:16px; padding: 3px" type="text" id="did"/></td>
        </tr>
        <tr>
            <td>Amount:</td>
            <td><input style="width: 400px; font-size:16px; padding: 3px" type="text" id="amount"/></td>
        </tr>
        <tr>
            <td colspan="2" align="center">
                <input style="width: 100px; font-size:16px; padding: 3px" type="button" value="Submit" id="button"/>
            </td>
        </tr>
    </table>
    <div id="responseDiv"></div>

</div>


<script type="text/javascript">
    $(document).ready(function () {
        // Gắn sự kiện onclick vào #viewbtn
        if ($.session.get("id")==null) {
            alert("Bạn phải đăng nhập.");
//                $.setCookie("phone",$("#phone").val());
//                $.setCookie("body",$("#body").val());
//                $.setCookie("caption",$("#caption").val());
            $.session.clear();
            window.parent.location.href = "../html/login.html";
        }
        $('#button').click(function () {
//          $('#loading').html('Processing...');
            $('#mydiv').mask("Loading...");
            $.ajax({
                url: "/tran/do",
                type: "GET",
//                data: "sid="+$("#sid").val()+"&did="+$("#did").val()+"&amount="+$("#amount").val(),
                data: { "sid":$("#sid").val(),
                        "did":$("#did").val(),
                        "amount":$("#amount").val(),
                        "action":"adjust",
                    id: $.session.get("id"),
                    username:$.session.get("username")
                },
                success: function (string) {

                    /**
                     * Kiểu mặc định trả về là dạng String, bạn dùng hàm parseJSON để phân tích dữ liệu trả về
                     * có 2 cách parse JSON là : JSON.parse() và $.parseJSON();
                     * 1. var getData = JSON.parse(string);
                     * 2. var getData = $.parseJSON(string);
                     **/
//                var getData = $.parseJSON(string);
                    $('#mydiv').unmask();
                    var error = string["error"];
                    if (error == 0)
                        alert("Thành công.");
                    else if (error == -1) {
                        alert("Bạn phải đăng nhập.");
                        $.session.clear();
                        window.parent.location.href = "../html/login.html";
                    }
                    else
                        alert("Không thành công. Error code = " + error);

//		$("#responseDiv").html("error: " + string["error"] +"\n" + "desc: " + string["desc"]);
                    //input dữ liệu lấy về từ server vào textbox
//                    $('#txt_username').val(getData.username);
//                    $('#txt_password').val(getData.password);
//                    $('#txt_email').val(getData.email);

//                    alert(string);


                    //Trả loading về trạng thái ban đầu
//                    $('#loading').html('&nbsp;');
                },
                error: function () {
                    $('#mydiv').unmask();
                    alert('Có lỗi kết nối xảy ra');
                }
            });
        });
    });

</script>
</body>
</html>