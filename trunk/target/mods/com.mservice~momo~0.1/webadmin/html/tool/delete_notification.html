<html>
<head>
    <title>Công cụ xóa noti</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="/css/mask.css" rel="stylesheet" type="text/css"/>
    <link href="/css/mycss.css" rel="stylesheet" type="text/css"/>
    <script src="/js/jquery.1.9.js"></script>
    <script src="/js/session.js"></script>
    <script src="/js/cookie.js"></script>
    <script type="text/javascript" src="/js/mask.js"></script>
    <script src="/js/jquery-ui.js"></script>
    <link rel="stylesheet" href="/css/jquery-ui.css" type="text/css"/>

    <style type="text/css">
        table, th, td {
        border: none;
        }
    </style>
</head>
<body>
<div id="mydiv">

    <h2>Công cụ xóa noti</h2>
    <table id="inputform">
        <tr>
            <td>Số tháng giữ lại:</td>
            <td><input type="text" id="numberOfMonth"/></td>
        </tr>
        <tr>
            <td>Đối tượng:</td>
            <td>
                <select id="object" name="enabled" style="width: 300px; font-size:14px; padding: 3px">
                    <option value="0">All</option>
                    <option value="1">EU</option>
                    <option value="2">DGD</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>
                <input style="width: 100px; font-size:16px; padding: 3px" type="button" value="Delete Data"
                       id="buttonTS"/>
            </td>

        </tr>
    </table>
    <div id="responseDiv"></div>

    <table id="tbresult">

    </table>

</div>

<script type="text/javascript">

    $(document).ready(function () {
        $('#buttonTS').click(function () {
            if ($.session.get("id") == null) {
                alert("Bạn phải đăng nhập.");
                $.session.clear();
                window.parent.location.href = "../html/login.html";
            }
            else {
                deleteData();
            }
        });

    });

    /* function deleteData() {
        $('#mydiv').mask("Loading...");
        $.ajax({
            url: "/deleteData",
            type: "POST",
            data: {
                numberOfMonth:$("#numberOfMonth").val(),
                object:$("#object").val()
            },

            success: function (result) {

                if(result === 0)
                {
                    alert('Khong co du lieu de xoa');
                }
                else
                {
                    executeDeleteData(result)
                }

                if(result)
                {
                    alert('DONE');
                }
                else{
                    alert('FAIL OI');
                }
                    $('#mydiv').unmask();
                    $("#numberOfMonth").val("");
                    $("#object").val("0");
            },
            error: function () {
                $('#mydiv').unmask();
                alert('Có lỗi kết nối xảy ra');
            }
        });
    } */

    function deleteData() {
        $('#mydiv').mask("Loading...");
        $.ajax({
            url: "/deleteData",
            type: "GET",
            data: {
                numberOfMonth:$("#numberOfMonth").val(),
                object:$("#object").val()
            },
            success: function (data) {
                var result = Number(data);
                if(result < 1)
                {
                    alert('Khong co du lieu de xoa');
                }
                else
                {
                    executeDeleteData(result, 1000);
                }
            },
            error: function (data) {
                $('#mydiv').unmask();
                alert('Có lỗi kết nối xảy ra');
            }
        });
    }

    function executeDeleteData(result, length)
    {
        if(result < length)
        {
            length = result;
        }
        sendDeleteData(result - 1, result - length);
    }

    function sendDeleteData(begin, end)
    {
        var startPoint = begin.toString();
        var endPoint = end.toString();
        $('#mydiv').mask("Loading... " + endPoint);
        $.ajax({
            url: "/sendDeleteData",
            type: "GET",
            data: {
                numberOfMonth:$("#numberOfMonth").val(),
                begin:endPoint,
                end:startPoint
            },

            success: function (result) {
                var intResult = Number(result);
                if(intResult > 0)
                {
                    executeDeleteData(intResult, 1000);
                }
                else
                {
                    //Het du lieu
                    $('#mydiv').unmask();
                    alert('DONE');
                }
            },
            error: function () {
                $('#mydiv').unmask();
                alert('Có lỗi kết nối xảy ra');
            }
        });
    }



</script>
</body>
</html>