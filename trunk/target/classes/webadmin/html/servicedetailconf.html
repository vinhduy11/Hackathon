<html>
<head>
    <title>Service Detail Config Page</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="../css/mask.css" rel="stylesheet" type="text/css"/>
    <link href="../css/mycss.css" rel="stylesheet" type="text/css"/>
    <script src="../js/jquery.1.9.js"></script>
    <script src="../js/session.js"></script>
    <script src="../js/cookie.js"></script>
    <script type="text/javascript" src="../js/mask.js"></script>
    <script type="text/javascript" src="../js/myjs.js"></script>

</head>
<body>
<div id="mydiv">
    <h2>Service Detail Config Page</h2>
    <input type="button" value="Reload Cache" id="btnReload"></td>
    <div class="clear"></div>

    <div style="float:left">
        <b>Service id</b>: <input type="text" style="border:1px solid #778899; width:150px" name="sServiceId" id="sServiceId">
        <input type="button" id="btnSearch" value="Search" >
    </div>
    <div class="clear"></div>

    <div id="table"></div>

    <div class="clear"></div>

    <div>
        <table>
            <tr>
                <th colspan="2">Edit Information</th>
            </tr>
            <tr>
                <td>Service ID</td>
                <td><input style="border: none" type="text" id="txtsId">
                    <input type="hidden" id="id_ser_de">
                </td>
            </tr>

            <tr>
                <td>Field Type</td>
                <td>
                    <!--<input style="border: none" type="text" id ="txtstatus">-->
                    <select id="txtfType" name="txtfType" style="width: 150px; font-size:14px; padding: 3px">
                        <option value="text">text</option>
                        <option value="drop">drop</option>
                        <option value="number">number</option>
                        <option value="button">button</option>
                        <option value="cash">cash</option>
                        <option value="date">date</option>
                        <option value="label">label</option>
                        <option value="caption">caption</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td>Field Label</td>
                <td><input style="border: none" type="text" id="txtfLable"></td>
            </tr>

            <tr>
                <td>Is Amount</td>
                <td><input style="width: 20px; height: 20px" type="checkbox" id="txtisA"></td>
            </tr>

            <tr>
                <td>Is BillId</td>
                <td><input style="width: 20px; height: 20px" type="checkbox" id="txtisB"></td>
            </tr>

            <tr>
                <td>Key</td>
                <td><input  style="border: none" type="text" id="txtkey"></td>
            </tr>

            <tr>
                <td>Required</td>
                <td><input style="width: 20px; height: 20px" type="checkbox" id="chkrequire"></td>
            </tr>

            <tr>
                <td>Order</td>
                <td><input  style="border: none" type="text" id="txtorder"></td>
            </tr>

            <tr>
                <td>Has child</td>
                <td>
                    <!--<input style="border: none" type="text" id ="txtstatus">-->
                    <select id="txthaschild" name="txthaschild" style="width: 150px; font-size:14px; padding: 3px">
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td>Line</td>
                <td>
                    <input  style="border: none" type="text" id="txtline">
                </td>
            </tr>

            <tr>
                <td colspan="2" align="center">
                    <input type="button" value="Create" id="btNew">
                    <input type="button" value="Update" id="btSave" disabled>
                </td>
            </tr>

        </table>
    </div>

</div>

<script type="text/javascript">
    $(function () {
        $(document).on("click", "#del", function () {
            var rid = $(this).attr("val");
            var id_ser_de = $(this).attr("id_ser_de");
            var result = confirm("Are you sure?");
            if (result == true) {
                $('#mydiv').mask("Loading...");
                $.ajax({
                    url: "/serdetail/del",
                    type: "GET",
                    data: {
                        _id : id_ser_de,
                        id: $.session.get("id"),
                        username:$.session.get("username")
                    },
                    success: function (string) {
                        $('#mydiv').unmask();
                        var error = string["error"];
                        if (error == 0) {
                            alert("Thành công.");
                            init();
                        }
                        else if (error == -1) {
                            alert("Bạn phải đăng nhập.");
                            $.session.clear();
                            window.parent.location.href = "../html/login.html";
                        }
                        else
                            alert("Không thành công. Error code = " + error);
                    },
                    error: function () {
                        $('#mydiv').unmask();
                        alert('Có lỗi kết nối xảy ra');
                    }
                });
            }
        });
    });

    $(function () {
        $(document).on("click", "#edit", function () {

            $("#btSave").prop("disabled", false);

            //lay id cua dong duoc click
            var rid = $(this).attr("val");
            var id_ser_de = $(this).attr("id_ser_de");
            var rowId = "td[rid=" + rid + "]";

            //lay mang cac td tag
            var tdArr = $(rowId)

            //lay value tung td tag
            var serviceID = tdArr[0].innerHTML;
            var fieldType = tdArr[1].innerHTML;
            var fieldLabel = tdArr[2].innerHTML;
            var isAmount = tdArr[3].firstChild.checked;
            var isBillId = tdArr[4].firstChild.checked;
            var key = tdArr[5].innerHTML;
            var isRequired = tdArr[6].firstChild.checked;
            var order = tdArr[7].innerHTML;
            var haschild = tdArr[8].innerHTML;
            var line = tdArr[9].innerHTML;

            $("#id_ser_de").val(id_ser_de);
            $("#txtsId").val(serviceID);
            $("#txtfType").val(fieldType);
            $("#txtfLable").val(fieldLabel);
            if (isAmount) {
                $("#txtisA").prop('checked', true);
            } else {
                $("#txtisA").prop('checked', false);
            }
            if (isBillId) {
                $("#txtisB").prop('checked', true);
            } else {
                $("#txtisB").prop('checked', false);
            }

            $("#txtkey").val(key);

            if (isRequired) {
                $("#chkrequire").prop('checked', true);
            } else {
                $("#chkrequire").prop('checked', false);
            }

            $("#txtorder").val(order);

            if(haschild ==="Yes"){
                $("#txthaschild").val("1")
            }else{
                $("#txthaschild").val("0")
            }

            $("#txtline").val(line);
        });
    });


    $('#btSave').click(function () {
        upsert();
    });
    $('#btNew').click(function () {
        $("#id_ser_de").val("");
        upsert();
    });

    $(document).ready(function () {
        init();
    });

    $('#btnSearch').click(function () {
        init();
    });

    function upsert() {
        if ($.session.get("id") == null) {
            alert("Bạn phải đăng nhập.");
            $.session.clear();
            window.parent.location.href = "../html/login.html";
        } else {
            $('#mydiv').mask("Loading...");
            $.ajax({
                url: "/serdetail/upsert",
                type: "GET",
                data: {
                    _id: $("#id_ser_de").val(),
                    ser_id: $("#txtsId").val(),
                    fi_ty: $("#txtfType").val(),
                    fi_la: $("#txtfLable").val(),
                    is_am: $("#txtisA").is(":checked"),
                    is_bi: $("#txtisB").is(":checked"),
                    id: $.session.get("id"),
                    username: $.session.get("username"),
                    key: $("#txtkey").val(),
                    requied:$("#chkrequire").is(":checked"),
                    order : $("#txtorder").val(),
                    haschild : $("#txthaschild").val(),
                    line : $("#txtline").val()
                },
                success: function (string) {
                    $('#mydiv').unmask();
                    var error = string["error"];
                    if (error == 0) {
                        alert("Thành công.");
                        $("#id_ser_de").val("");
                        $("#txtsId").val("");
                        $("#txtfType").val("text");
                        $("#txtfLable").val("");
                        $("#txtisA").prop('checked', false);
                        $("#txtisB").prop('checked', false);
                        $("#txtkey").val("");
                        setCheckbox("#chkrequire",false);
                        $("#txtorder").val("");
                        init()
                    }
                    else if (error == -1) {
                        alert("Bạn phải đăng nhập.");
                        $.session.clear();
                        window.parent.location.href = "../html/login.html";
                    }
                    else
                        alert("Không thành công. Error code = " + error);
                },
                error: function () {
                    $('#mydiv').unmask();
                    alert('Có lỗi kết nối xảy ra');
                }
            });
        }
    }

    function init() {
        $("#btSave").prop("disabled", true);
        $.ajax({
            url: "/serdetail/getall",
            type: "GET",
            data: {
                sid: $("#sServiceId").val()
            },
            success: function (string) {
                table = string["table"];
                $("#table").html("");
                $("#table").html(table);
            },
            error: function () {
                alert('Có lỗi kết nối xảy ra');
            }
        });
    }
    $('#btnReload').click(function () {
        reload();
    });
    function reload(){
        $.ajax({
            url: "/serdetail/reload",
            type: "GET",
            success: function (string) {
                $('#mydiv').unmask();
                var error = string["error"];
                if (error == 0) {
                    alert("Thành công.");
                }
                else if (error == -1) {
                    alert("Bạn phải đăng nhập.");
                    $.session.clear();
                    window.parent.location.href = "../html/login.html";
                }
                else
                    alert("Không thành công. Error code = " + error);
            },
            error: function () {
                $('#mydiv').unmask();
                alert('Có lỗi kết nối xảy ra');
            }
        });
    }

</script>
</body>
</html>