<!DOCTYPE html>
<html>
<head>
    <title>Cấu hình dịch vụ connector</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="../css/mask.css" rel="stylesheet" type="text/css"/>
    <link href="../css/mycss.css" rel="stylesheet" type="text/css"/>
    <script src="../js/jquery.1.9.js"></script>
    <!--<script src="../js/session.js"></script>-->
    <!--<script src="../js/cookie_OLD.js"></script>-->
    <script type="text/javascript" src="../js/mask.js"></script>
    <link rel="stylesheet" href="../css/jquery.datetimepicker.css" type="text/css"/>
    <script src="../js/jquery.datetimepicker.js"></script>
</head>
<body>

<div>
    <h2>Cấu hình dịch vụ connector</h2>
    <hr />
    <table id="table">
    </table>
    <hr />
</div>
<hr />
<table>
    <tr>
        <td>Service Id:</td>
        <td><input type="text" id="service_id" style="width: 300px; font-size:14px; padding: 3px"/></td>
    </tr>
    <tr>
        <td>Bus Name:</td>
        <td><input type="text" id="busname" style="width: 300px; font-size:14px; padding: 3px"/></td>
    </tr>
    <tr>
        <td>Bill Pay:</td>
        <td><input type="text" id="billpay" style="width: 300px; font-size:14px; padding: 3px"/></td>
    </tr>

    <tr>
        <td>Service Type:</td>
        <td>
            <select id="service_type" name="service_type" style="width: 300px; font-size:14px; padding: 3px">
                <option value="1">momo.json</option>
                <option value="2">shoppingverticle.json</option>
            </select>
        </td>
    </tr>

    <tr>
        <td>Service Type Name:</td>
        <td><input type="text" id="service_type_name" style="width: 300px; font-size:14px; padding: 3px"/></td>
    </tr>

    <tr>
        <td>Getting Info Type:</td>
        <td><input type="text" id="type" style="width: 300px; font-size:14px; padding: 3px"/></td>
    </tr>

    <tr>
        <td>Kiểm tra định danh:</td>
        <td>
            <input type="checkbox" id="chkEnable">
        </td>
    </tr>

    <tr>
        <td></td>
        <td>
            <button id="btnClear">Clear</button>
            <button id="btnSave">Save</button>
            <button id="btnRefresh">Refresh</button>
        </td>
    </tr>
</table>
<script type="text/javascript">

    function clearTable() {
        var head = "<tr>";
        head += "<th>*</th>";
        head += "<th>Service Id</th>";
        head += "<th>Bus Name</th>";
        head += "<th>Bill Pay</th>";
        head += "<th>Service Type</th>";
        head += "<th>Service Type Name</th>";
        head += "<th>Getting Info Type</th>";
        head += "<th>Kiểm tra định danh</th>";
        head += "</tr>";
        $("#table").html(head);
    }

    function addItem(item) {
        var row;
        var editButton = "<button id='edit_" + item._id + "'>Edit</button>";

        row = "<tr id='r_" + item._id + "'>";
        row += "<td> " + editButton + " </td>";
        row += "<td> " + item._id + " </td>";
        row += "<td> " + item.busname + " </td>";
        row += "<td> " + item.billpay + " </td>";
        row += "<td> " + item.service_type + " </td>";
        row += "<td> " + item.service_type_name + " </td>";
        row += "<td> " + item.type + " </td>";
        if(item.isNamedChecked)
        {
            row += "<td> Enabled  </td>";
        }
        else
        {
            row += "<td>  Disabled  </td>";
        }
        row += "</tr>";

        $("#table").append(row);

        $("#edit_" + item._id).click(function () {
            setFormValues(item);
        });
    }

    function setFormValues(item) {
        $("#service_id").val(item._id);
        $("#busname").val(item.busname);
        $("#billpay").val(item.billpay);
        $("#service_type").val(item.service_type);
        $("#service_type_name").val(item.service_type_name);
        $("#type").val(item.type);
        if(item.isNamedChecked)
        {
            $("#chkEnable").prop('checked', true);
        }
        else{
            $("#chkEnable").prop('checked', false);
        }

    }

    function loadPage() {
        clearTable();
        var mUrl = "/getConnectorService";
        $.getJSON(mUrl).done(function (data) {
            $.each(data, function (i, item) {
                addItem(item);
            });
        });
    }
    $(document).ready(function () {
        loadPage();

        $("#btnSave").click(function () {
            $.ajax({
                url: "/updateConnectorService",
                type: "GET",
                enctype: "multipart/form-data",
                data: {
                    service_id :$("#service_id").val(),
                    busname:$("#busname").val(),
                    billpay:$("#billpay").val(),
                    service_type:$("#service_type").val(),
                    service_type_name :$("#service_type_name").val(),
                    checkedValue :$('.chkEnable:checked').val(),
                    type :$("#type").val()

                },
                success: function (result) {
                    if (result) {
                        alert("Thành công.");
                        loadPage();
                    }
                    else
                        alert(result.desc);
                },
                error: function () {
                    alert('Có lỗi kết nối xảy ra');
                }
            });
        });

        $("#btnRefresh").click(function () {
            $.ajax({
                url: "/reloadConnectorService",
                type: "GET",
                enctype: "multipart/form-data",
                data: {
                },
                success: function (result) {
                    if (result) {
                        alert("Thành công.");
                        loadPage()
                    }
                    else
                        alert("That bai");
                },
                error: function () {
                    alert('Có lỗi kết nối xảy ra');
                }
            });
        });
    });
</script>
</body>
</html>