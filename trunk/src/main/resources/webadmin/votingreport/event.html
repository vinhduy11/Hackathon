<html>
<head>
    <title>Momo Page</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="../css/mask.css" rel="stylesheet" type="text/css"/>
    <link href="../css/mycss.css" rel="stylesheet" type="text/css"/>
    <script src="../js/jquery.1.9.js"></script>
    <script src="../js/session.js"></script>
    <script src="../js/cookie.js"></script>
    <script src="../js/mask.js"></script>
    <link rel="stylesheet" href="../css/jquery.datetimepicker.css" type="text/css"/>
    <script src="../js/jquery.datetimepicker.js"></script>
</head>
<body>
<div id="duinfo" style="height:50px">
    <span style="float: left; border:1px; font-weight:bold; font-size: 25px; padding-left:15px">Kết Quả Bình Chọn </span>
    <span style="float: right; border:1px"> Xin chào, <span style="color: #0000ff" id="husername"></span> &nbsp;&nbsp;
    <button
            id="logout"> Logout
    </button> </span>
</div>
<div id="mydiv" style="padding-left: 16px;">
    <table>
        <tr>
            <td>Mã chương trình:</td>
            <td><input style="width: 150px; font-size:16px; padding: 3px" type="text" id="txtCode"/></td>

            <td>Mã phiên:</td>
            <td><input style="width: 150px; font-size:16px; padding: 3px" type="text" id="txtCollection"/></td>

            <td align="center">
                <input style="padding: 3px; cursor:pointer;" type="button" value="Refresh" id="btnCheck"/>
            </td>
        </tr>
    </table>
</div>
<div class="clear"></div>
<div id="mydiv2" style="padding-left: 16px;">

    <div style="float:left">
        <div style="font-weight:bold;text-transform: uppercase;">Chi tiết</div>
        <table id="data">
        </table>
    </div>

    <div style="float:left; margin-left:10px;">
        <div style="font-weight:bold;text-transform: uppercase;">Tổng hợp khách hàng</div>
        <table id="sumbynum">

        </table>
        <div class="clear"></div>
    </div>

    <div style="float:left; margin-left:10px;">
        <div style="font-weight:bold;text-transform: uppercase;">Tổng hợp</div>
        <table id="sum">

        </table>
        <div class="clear"></div>
    </div>

    <div class="clear"></div>
    <div class="clear"></div>

</div>

<script type="text/javascript">

    function clearTable() {
        var head = "<tr>";
        head += "<th>SĐT</th>";
        head += "<th>Tên</th>";
        head += "<th>Mã </th>";
        head += "<th>Sms</th>";
        head += "<th>Thời gian</th>";
        head +="</tr>";
        $("#data").html(head);

        var headsum = "<tr>";
        headsum += "<th>Căp</th>";
        headsum += "<th>SMS</th>";
        headsum +="</tr>";
        $("#sum").html(headsum);

        var headsumbynum = "<tr>";
        headsumbynum += "<th>SĐT</th>";
        headsumbynum += "<th>Tên</th>";
        headsumbynum += "<th>Slượng</th>";
        headsumbynum +="</tr>";
        $("#sumbynum").html(headsumbynum);

    }

    function addItem(item) {
        var row;
        row = "<tr>";
        row += "<td> " + item.number + " </td>";
        row += "<td> " + item.name + " </td>";
        row += "<td> " + item.code + " </td>";
        row += "<td> " + item.vamount + " </td>";
        row += "<td> " + item.timevn + " </td>";
        row += "</tr>";
        $("#data").append(row);
    }

    function addSum(item) {
        var row;
        row = "<tr>";
        row += "<td> " + item.code + " </td>";
        row += "<td> " + item.amount + " </td>";
        row += "</tr>";
        $("#sum").append(row);
    }

    function addSumByNum(item) {
        var row;
        row = "<tr>";
        row += "<td> " + item.num + " </td>";
        row += "<td> " + item.name + " </td>";
        row += "<td> " + item.vote + " </td>";
        row += "</tr>";
        $("#sumbynum").append(row);
    }

    function loadPage() {
        clearTable();
        var username = $.session.get("username");
        var password = $.session.get("password");
        var code = $("#txtCode").val();
        var collection = $("#txtCollection").val();

        if(code === ""){
            alert("Nhập mã chương trình");
            $("#txtCode").focus();
            return;
        }

        var mUrl = "/votingreport/getByServiceId?code=" + code
                                           + "&uname=" + username
                                           + "&pass=" + password
                                           + "&collection=" + collection;

        $.getJSON(mUrl).done(function (data) {
            $.each(data, function (i, item) {

                if(i==0 && item.data != null){
                    for(i=0; i<item.data.length;i++){
                        addItem(item.data[i]);
                    }
                }

                if(i==1 && item.sum != null){
                    for(i=0; i<item.sum.length;i++){
                        addSum(item.sum[i]);
                    }
                }

                if(i==2 && item.sumbn != null){
                    for(i=0; i<item.sumbn.length;i++){
                        addSumByNum(item.sumbn[i]);
                    }
                }

            });
        });
    }

    $(document).ready(function () {

        $("#husername").text($.session.get("username"));
        if($("#husername").text() === "")
        {
         alert("Bạn phải đăng nhập.");
         $.session.clear();
         window.parent.location.href = "../votingreport/login.html";
        }
        $("#txtCode").focus();
        $(document).keydown(function(e) {
            //enter
            if(e.keyCode == 13){
                loadPage();
            }
        });

        $("#btnCheck").click(function(){
            loadPage();
        });

        $('#logout').click(function (){
            $.session.clear();
            window.parent.location.href = "login.html";
        });
    });




</script>
</body>
</html>