<!DOCTYPE html>
<html>
<head lang="en">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <link rel="stylesheet" type="text/css" href="extjs/resources/css/ext-all-neptune.css"/>

    <script type="text/javascript" src="extjs/ext-all-debug.js"></script>
</head>
<body>
<script type="application/javascript">

    function reloadTestInfo() {
            Ext.Ajax.request({
                url: '/service/config/getTestInfo',
                params: {
                },
                success: function (response) {
                    var obj = Ext.decode(response.responseText);
                    Ext.getCmp("chkTestMode").setValue(obj.testMode);

                    Ext.getCmp("txtPhoneList").setValue(obj.phones);
                },
                failure: function () {
                    console.log("Can't perform request");
                }
            });
    };

    function applyTestInfo() {
        Ext.Ajax.request({
            url: "service/config/setTestInfo",
            method: "POST",
            params: {
                testMode: Ext.getCmp("chkTestMode").getValue(),
                phones: Ext.getCmp("txtPhoneList").getValue()
            },
            success: function(response) {
                reloadTestInfo();
            },
            failure: function() {
                Ext.Msg.alert('Error', "Can't perform request.");
            }
        });
    }

    var testPhonelistForm = Ext.create("Ext.panel.Panel", {
        margin: 5,
        width: "100%",
        title: "Test phone list",
        layout: 'form',
        bodyPadding: 5,
        tools : [
            {
                type: "refresh",
                text: "abc",
                listeners : {
                    click: reloadTestInfo
                }
            }
        ],
        items: [
            {
                fieldLabel: "Test mode:",
                xtype: "checkbox",
                id: "chkTestMode"
            },
            {
                fieldLabel: "Phone numbers:",
                xtype: "textarea",
                high: "300",
                id: "txtPhoneList"
            },
            {
                xtype: 'toolbar',
                dock: 'bottom',
                border: false,
                items: [

                    '->',
                    {
                        xtype: "button",
                        text: 'Apply',
                        listeners: {
                            click: applyTestInfo
                        }
                    }
                ]
            }
        ]
    });

    var abc = Ext.create("Ext.panel.Panel", {
        margin: 5,
        width: "100%",
        title: "Test phone list"
    });

    Ext.onReady(function () {
        Ext.create('Ext.Viewport', {
            layout: {
                type: "vbox"
            },

            items: [
                testPhonelistForm,abc
            ]
        });
        reloadTestInfo();
    });
</script>
</body>
</html>