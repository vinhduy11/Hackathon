<html>
<head>
    <title>Promotion Configuration Page</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="../css/mask.css" rel="stylesheet" type="text/css"/>
    <link href="../css/mycss.css" rel="stylesheet" type="text/css"/>
    <script src="../js/jquery.1.9.js"></script>
    <script src="../js/session.js"></script>
    <script src="../js/cookie.js"></script>
    <script type="text/javascript" src="../js/mask.js"></script>
    <link rel="stylesheet" href="../css/jquery-ui.css" type="text/css"/>
    <script src="../js/jquery-ui.js"></script>
    <script>
        $(function() {
            $("#txtFrDate").datepicker({ dateFormat: "dd/mm/yy" });
        });
    </script>
    <script>
        $(function() {
            $("#txtToDate").datepicker({ dateFormat: "dd/mm/yy" });
        });
    </script>

</head>
<body>
<div id="mydiv">
    <h2>Promotion Configuration Page</h2>
    <input type="button" value="Reload Cache" id="btnReload"></td>
    <div class="clear"></div>
    <div id="table"></div>

    <div class="clear"></div>

    <div>
        <table>
            <tr>
                <th colspan="2">Edit Information</th>
            </tr>
            <tr>
                <td>Promo Name</td>
                <td><input type="text" id ="txtName"></td>
            </tr>

            <tr>
                <td>From Date</td>
                <td><input type="text" id ="txtFrDate"></td>
            </tr>

            <tr>
                <td>To Date</td>
                <td><input type="text" id ="txtToDate"></td>
            </tr>

            <tr>
                <td>Tran Min Value</td>
                <td><input type="text" id ="txtTranMinVal"></td>
            </tr>

            <tr>
                <td>Per Tran Value</td>
                <td><input type="text" id ="txtPreTranVal"></td>
            </tr>

            <tr>
                <td>Duration</td>
                <td><input type="text" id ="txtDuration"></td>
            </tr>

            <tr>
                <td>Intro Data</td>
                <td><textarea class="input" id="txtIntroData"></textarea></td>
            </tr>

            <tr>
                <td>Intro SMS/ Gift Type ID</td>
                <td><textarea class="input" id="txtIntroSMS"></textarea></td>
            </tr>
            <tr>
                <td>Min Times</td>
                <td><input type="text" id ="txtMinTimes"></td>
            </tr>
            <tr>
                <td>Max Times</td>
                <td>
                    <input type="text" id ="txtMaxTimes">
                </td>
            </tr>
            <tr>
                <td>Noti Caption</td>
                <td>
                    <input type="text" id ="txtNotiCap"></td>
            </tr>
            <tr>
                <td>Noti Body Inviter/ Adjust Account 2 </td>
                <td><textarea class="input" id="txtNotiBodyInviter"></textarea></td>
            </tr>
            <tr>
                <td>Noti SMS Inviter</td>
                <td><textarea class="input" id="txtNotiSMSInviter"></textarea></td>
            </tr>
            <tr>
                <td>Noti Body Invitee</td>
                <td><textarea class="input" id="txtNotiBodyInvitee"></textarea></td>
            </tr>
            <tr>
                <td>Noti SMS Invitee</td>
                <td><textarea class="input" id="txtNotiSMSInvitee"></textarea></td>
            </tr>
            <tr>
                <td>Noti Comment</td>
                <td><textarea class="input" id="txtNotiComment"></textarea></td>
            </tr>
            <tr>
                <td>Adjust Account</td>
                <td><input type="text" id ="txtAdjustAccount">
                    <input type="hidden" id = "id_promo">
                </td>
            </tr>

            <tr>
                <td>Duration Tran</td>
                <td><input type="text" id ="txtDurationTran"></td>
            </tr>

            <tr>
                <td>Pin</td>
                <td>
                    <input type="text" id ="txtPin">
                </td>
            </tr>

            <tr>
                <td colspan="2">
                    <div style="float:left;">
                        OffTime From<br>(yyyy-mm-dd hh:mm:ss): <input style="width:200px;border: 1px solid #778899;" type="text" id ="txtOffTimeFrom"> OffTime To(yyyy-mm-dd hh:mm:ss):  <input style="width:200px;border: 1px solid #778899;" type="text" id ="txtOffTimeTo">
                    </div>
                </td>
            </tr>
            <tr>
                <td>Status</td>
                <td>
                    <input type="checkbox" id="chkStatus">
                </td>
            </tr>
            <tr>
                <td>Status IOS</td>
                <td>
                    <input type="checkbox" id="chkStatusIOS">
                </td>
            </tr>
            <tr>
                <td>Status ANDROID</td>
                <td>
                    <input type="checkbox" id="chkStatusANDROID">
                </td>
            </tr>
            <tr>
                <td>Enable Phase 02</td>
                <td>
                    <input type="checkbox" id="chkEnable">
                </td>
            </tr>
            <tr>
                <td>Extra Infomation</td>
                <td>
                    <input type="text" id="txtExtra">
                </td>
            </tr>
            <tr>
                <td colspan="2" align="center">
                    <input type="button" value="Create" id="btNew">
                    <input type="button" value="Update" id="btSave" disabled></td>
            </tr>
        </table>
    </div>

</div>

<script type="text/javascript">

    $(function () {

        $( document ).on( "click", "button", function(){

            $("#btSave").prop("disabled",false);
            $('#txtName').attr("disabled", true);

            //lay id cua dong duoc click
            var rid =$(this).attr("val");
            var id_promo =$(this).attr("id_promo");
            var rowId = "td[rid=" + rid + "]";

            //lay mang cac td tag
            var tdArr = $(rowId)

            //lay value tung td tag
            var name = tdArr[0].innerHTML;
            var frDate =tdArr[1].innerHTML;
            var toDate =tdArr[2].innerHTML;
            var tranMinVal =tdArr[3].innerHTML;
            var preTranVal =tdArr[4].innerHTML;
            var dru =tdArr[5].innerHTML;
            var introData = tdArr[6].innerHTML;
            var introSms =tdArr[7].innerHTML;
            var minTimes =tdArr[8].innerHTML;
            var maxTimes =tdArr[9].innerHTML;
            var notiCap =tdArr[10].innerHTML;
            var bodyInviter =tdArr[11].innerHTML;
            var smsInviter =tdArr[12].innerHTML;
            var bodyInvitee =tdArr[13].innerHTML;
            var smsInvitee =tdArr[14].innerHTML;
            var notiCom =tdArr[15].innerHTML;
            var adjustAcc =tdArr[16].innerHTML;

            var durationTran =tdArr[17].innerHTML;
            var adjustPin =tdArr[18].innerHTML;

            $("#id_promo").val(id_promo);
            $("#txtName").val(name);
            $("#txtFrDate").val(frDate);
            $("#txtToDate").val(toDate);
            $("#txtTranMinVal").val(tranMinVal);
            $("#txtPreTranVal").val(preTranVal);
            $("#txtDuration").val(dru);
            $("#txtIntroData").val(introData);
            $("#txtIntroSMS").val(introSms);
            $("#txtMinTimes").val(minTimes);
            $("#txtMaxTimes").val(maxTimes);
            $("#txtNotiCap").val(notiCap);
            $("#txtNotiBodyInviter").val(bodyInviter);
            $("#txtNotiSMSInviter").val(smsInviter);
            $("#txtNotiBodyInvitee").val(bodyInvitee);
            $("#txtNotiSMSInvitee").val(smsInvitee);
            $("#txtNotiComment").val(notiCom);
            $("#txtAdjustAccount").val(adjustAcc);

            $("#txtDurationTran").val(durationTran);
            $("#txtPin").val(adjustPin);
            $("#txtOffTimeFrom").val(tdArr[19].innerHTML);
            $("#txtOffTimeTo").val(tdArr[20].innerHTML);

            var status = tdArr[21].innerHTML;
            if("true" === status || true === status){
                $("#chkStatus").prop('checked', true);
            }else{
                $("#chkStatus").prop('checked', false);
            }

            var statusIOS = tdArr[22].innerHTML;
            if("true" === statusIOS || true === statusIOS){
                $("#chkStatusIOS").prop('checked', true);
            }else{
                $("#chkStatusIOS").prop('checked', false);
            }

            var statusANDROID = tdArr[23].innerHTML;
            if("true" === statusANDROID || true === statusANDROID){
                $("#chkStatusANDROID").prop('checked', true);
            }else{
                $("#chkStatusANDROID").prop('checked', false);
            }

            var enablePhase2 = tdArr[24].innerHTML;
            if("true" === enablePhase2 || true === enablePhase2){
                $("#chkEnable").prop('checked', true);
            }else{
                $("#chkEnable").prop('checked', false);
            }

            var extra =tdArr[25].innerHTML;
            $("#txtExtra").val(extra);
        });
    });

    $('#btNew').click(function () {
        $("#id_promo").val("");
        upsert();
    });
    $('#btSave').click(function () {
        upsert();
    });
    $('#btnReload').click(function () {
        reloadPro();
    });

    function reloadPro(){
        if ($.session.get("id")==null) {
            alert("Bạn phải đăng nhập.");
            $.session.clear();
            window.parent.location.href = "../html/login.html";
        } else {
            $('#mydiv').mask("Loading...");
            $.ajax({
                url: "/promo/reload",
                type: "GET",
                data: {
                    id: $.session.get("id")
                },
                success: function (string) {
                    $('#mydiv').unmask();
                    var error = string["error"];
                    if (error == 0) {
                        alert("Thành công.");
                    }
                    else if (error == -1) {
                        alert("Bạn phải đăng nhập.");
                        $.session.clear();
                        window.parent.location.href = "../html/login.html";
                    }
                    else
                        alert("Không thành công. Error code = " + error);
                },
                error: function () {
                    $('#mydiv').unmask();
                    alert('Có lỗi kết nối xảy ra');
                }
            });
        }
    }

    function upsert(){
        if ($.session.get("id")==null) {
            alert("Bạn phải đăng nhập.");
            $.session.clear();
            window.parent.location.href = "../html/login.html";
        } else {
            $('#mydiv').mask("Loading...");
            $.ajax({
                url: "/promo/upsert",
                type: "GET",
                data: {
                    id_promo: $("#id_promo").val(),
                    name: $("#txtName").val(),
                    frDate: $("#txtFrDate").val(),
                    toDate: $("#txtToDate").val(),
                    tranMinVal: $("#txtTranMinVal").val(),
                    preTranVal: $("#txtPreTranVal").val(),
                    dru: $("#txtDuration").val(),
                    introData: $("#txtIntroData").val(),
                    introSms: $("#txtIntroSMS").val(),
                    minTimes: $("#txtMinTimes").val(),
                    maxTimes: $("#txtMaxTimes").val(),
                    notiCap: $("#txtNotiCap").val(),
                    bodyInviter: $("#txtNotiBodyInviter").val(),
                    smsInviter: $("#txtNotiSMSInviter").val(),
                    bodyInvitee: $("#txtNotiBodyInvitee").val(),
                    smsInvitee: $("#txtNotiSMSInvitee").val(),
                    notiCom: $("#txtNotiComment").val(),
                    adjustAcc: $("#txtAdjustAccount").val(),
                    durationTran:$("#txtDurationTran").val(),
                    pin:$("#txtPin").val(),
                    id: $.session.get("id"),
                    username:$.session.get("username"),
                    OffTimeFrom:$("#txtOffTimeFrom").val(),
                    OffTimeTo:$("#txtOffTimeTo").val(),
                    status: $("#chkStatus").is(":checked"),
                    statusIOS: $("#chkStatusIOS").is(":checked"),
                    statusANDROID: $("#chkStatusANDROID").is(":checked"),
                    enablePhase2: $("#chkEnable").is(":checked"),
                    extra:$("#txtExtra").val()
                },
                success: function (string) {
                    $('#mydiv').unmask();
                    var error = string["error"];
                    if (error == 0) {
                        alert("Thành công.");
                        $("#id_promo").val("");
                        $("#txtName").val("");
                        $("#txtFrDate").val("");
                        $("#txtToDate").val("");
                        $("#txtTranMinVal").val("");
                        $("#txtPreTranVal").val("");
                        $("#txtDuration").val("");
                        $("#txtIntroData").val("");
                        $("#txtIntroSMS").val("");
                        $("#txtMinTimes").val("");
                        $("#txtMaxTimes").val("");
                        $("#txtNotiCap").val("");
                        $("#txtNotiBodyInviter").val("");
                        $("#txtNotiSMSInviter").val("");
                        $("#txtNotiBodyInvitee").val("");
                        $("#txtNotiSMSInvitee").val("");
                        $("#txtNotiComment").val("");
                        $("#txtAdjustAccount").val("");
                        $("#txtOffTimeFrom").val("");
                        $("#txtOffTimeTo").val("");
                        $("#chkStatus").prop('checked', false);
                        $("#chkStatusIOS").prop('checked', false);
                        $("#chkStatusANDROID").prop('checked', false);
                        $("#chkEnable").prop('checked', false);
                        $("#txtExtra").val("");
                        init();
                    }
                    else if (error == -1) {
                        alert("Bạn phải đăng nhập.");
                        $.session.clear();
                        window.parent.location.href = "../html/login.html";
                    }
                    else
                        alert("Không thành công. Error code = " + error);
                },
                error: function () {
                    $('#mydiv').unmask();
                    alert('Có lỗi kết nối xảy ra');
                }
            });
        }
    }

    $(document).ready(function () {
        init();
    });

    function init(){
        $('#txtName').attr("disabled", false);
        $("#btSave").prop("disabled", true);
        $.ajax({
            url: "/promo/getall",
            type: "GET",
            data: {
            },
            success: function (string) {
                table = string["table"];
                $("#table").html(table);
            },
            error: function () {
                alert('Có lỗi kết nối xảy ra');
            }
        });
    }

</script>
</body>
</html>