<html>
<head>
    <title>PG Galaxy Hist</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="../css/mask.css" rel="stylesheet" type="text/css"/>
    <link href="../css/mycss.css" rel="stylesheet" type="text/css"/>
    <script src="../js/jquery.1.9.js"></script>
    <script src="../js/session.js"></script>
    <script src="../js/cookie.js"></script>
    <script type="text/javascript" src="../js/mask.js"></script>
    <link rel="stylesheet" href="../css/jquery-ui.css" type="text/css"/>
    <script src="../js/jquery-ui.js"></script>
    <link rel="stylesheet" href="../css/jquery.datetimepicker.css" type="text/css"/>
    <script src="../js/jquery.datetimepicker.js"></script>

</head>
<body style="padding-left:15px">
<div id="mydiv">
    <h2>PG Report Page</h2>
    <table>
        <tr>
            <td>Nhập mã PG:</td>
            <td><input style="width: 200px; font-size:16px; padding: 3px" type="text" id="txtCode"/></td>
            <td>Số điện thoại:</td>
            <td><input style="width: 200px; font-size:16px; padding: 3px" type="text" id="txtNum" /></td>
        </tr>
        <tr>
            <td>Từ ngày:</td>
            <td><input style="width: 200px; font-size:16px; padding: 3px" type="text" id="txtFrom"/></td>
            <td>Đến ngày:</td>
            <td><input style="width: 200px; font-size:16px; padding: 3px" type="text" id="txtTo"/></td>
        </tr>
        <tr>
            <td align="center" colspan="4">
                <input style="padding: 3px; cursor:pointer;" type="button" value="Tìm kiếm (Enter)" id="btnCheck" />
            </td>
        </tr>
    </table>
    <br>

    <div class="clear"></div>
    <table id="divTable"></table>
    <div class="clear"></div>
</div>

<script type="text/javascript">

    function clearTable() {
        var head = "<tr>";
        head += "<th>STT</th>";
        head += "<th>Mã PG</th>";
        head += "<th>Số điện thoại</th>";
        head += "<th>Giá trị khuyến mãi</th>";
        head += "<th>Thời gian</th>";
        head += "<th>Tên dịch vụ</th>";
        head +="</tr>";
        $("#divTable").html(head);
    }
    function addItem(i, item) {
        var row;
        if(i%2==0)
            row = "<tr>";
        else
            row = "<tr style=\"background:#E6E9FF\">";
        row += "<td align=\"center\"> " + (i+1) + "</td>";
        row += "<td> " + item.pgcode + "</td>";
        row += "<td> 0" + item.number + " </td>";
        row += "<td align=\"right\"> " + item.amount + " </td>";
        row += "<td> " + item.timevn + "</td>";
        row += "<td> " + item.tranname + " </td>";
        row += "</tr>";
        $("#divTable").append(row);
    }

    $(document).ready(function () {

        $("#txtCode").focus();

        $("#txtFrom").datetimepicker({
            format: 'd/m/Y, H:i:s'
        });
        $("#txtTo").datetimepicker({
            format: 'd/m/Y, H:i:s'
        });

        $(document).keydown(function (event) {
             if(event.which == 13){
                init();
                return false;
             }
        });

        $("#btnCheck").click(function(){
            init();
        });
    });

    function init(){

        $("#divTable").html("");
        if($("#txtFrom").val()=="" || $("#txtTo").val()==""){
            alert("Vui lòng chọn từ ngày, đến ngày.");
            return;
        }
        if($("#txtNum").val()!="" && $("#txtNum").val().length<9){
            alert("Số điện thoại không hợp lệ.");
            return;
        }
        $.ajax({
            url: "/pghist/get",
            type: "GET",
            data: {
                "pgcode":$("#txtCode").val(),
                "pgnum":$("#txtNum").val(),
                "fromdate":$("#txtFrom").val(),
                "todate":$("#txtTo").val(),

                id: $.session.get("id"),
                username:$.session.get("username")
            },
            success: function (data) {
                if(data.length>0)
                    clearTable();
                else
                    $("#divTable").html("Không có dữ liệu.");
                $.each(data, function (i, item) {
                    if (item['error'] == -1) {
                        alert("Bạn phải đăng nhập.");
                        $.session.clear();
                        window.parent.location.href = "../html/login.html";
                    }
                    addItem(i, item);
                });
            },
            error: function () {
                alert('Có lỗi kết nối xảy ra');
            }
        });
    }

</script>
</body>
</html>