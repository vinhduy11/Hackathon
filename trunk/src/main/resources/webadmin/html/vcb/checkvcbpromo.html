<!DOCTYPE html>
<html>
<head>
    <title>Store Warning</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="/css/mask.css" rel="stylesheet" type="text/css"/>
    <link href="/css/mycss.css" rel="stylesheet" type="text/css"/>
    <script src="/js/jquery.1.9.js"></script>
    <script type="text/javascript" src="/js/mask.js"></script>
    <link rel="stylesheet" href="/css/jquery-ui.css" type="text/css"/>
    <script src="/js/jquery-ui.js"></script>

    <style type="text/css">
        table,th,td
        {
            border:1px solid #778899;
            padding-left:5px;
            padding-right:5px;
        }
        table {
            border-collapse: collapse;
            table-layout: fixed;
        }

        th {
            background-color: #2F4F4F;
            color:white;
            height:40px;
        }
    </style>

</head>
<body>

<div>
    <h2>Check VCB Promotion</h2>
    <table border="0">
        <tr style="border:0px ;">
            <td style="border:0px ;text-decoration:underline;font-weight:bold;">Phone number</td>
            <td style="border:0px ;text-decoration:underline;font-weight:bold;">Card id</td>
            <td><button id="btnSubmit">Thực hiện</button></td>
        </tr>

        <tr style="border:0px ;">
            <td><input style="width:100px; border:1px solid #778899;" id="txtnumber" name="txtnumber" type="text"/></td>
            <td><input style="width:100px; border:1px solid #778899;" id="txtcardid" name="txtcardid" type="text"/></td>
        </tr>
    </table>
    <div class="clear"></div>

    <table>
        <tr>
            <th>Thông tin Map ví Vietcombank</th>
        </tr>
        <tr>
            <td>
                <div id="vcbcmnd"></div>
            </td>
        </tr>
    </table>
    <div class="clear"></div>

    <table>
        <tr>
            <th>Thông tin đã nhận khuyến mãi</th>
        </tr>
        <tr>
            <td>
                <div id="vcb"></div>
            </td>
        </tr>
    </table>
    <div class="clear"></div>

    <table>
        <tr>
            <th>
                Thông tin người được giới thiệu - người giới thiệu
            </th>
        </tr>

        <tr>
            <td>
                <div id="phone"></div>
            </td>
        </tr>
    </table>
    <div class="clear"></div>

    <table>
        <tr>
            <th colspan="2">Cập nhật thông tin ví</th>
        </tr>
        <tr>
            <td>Phone number : </td>
            <td><input style="width:100px; border:1px solid #778899;" id="txtunumber" name="txtunumber" type="text"/></td>
        </tr>
        <tr>
            <td>Card Id : </td>
            <td><input style="width:100px; border:1px solid #778899;" id="txtucardid" name="txtucardid" type="text"/></td>
        </tr>
        <tr>
            <td colspan="2"> <div style="text-align :center;" ><button id="btnuSubmit">Cập nhật</button></div> </td>
        </tr>
    </table>
</div>

<script type="text/javascript">

    $(document).ready(function () {
        $("#btnuSubmit").click(function(){
            $.ajax({
                url: "/vcb/updatephone",
                type: "GET",
                data: {
                    number: $("#txtunumber").val(),
                    cardid: $("#txtucardid").val()
                },
                success: function (result) {
                    var err = result.err;
                    var desc = result.desc;
                    if(err === 0){

                        $.ajax({
                            url: "/vcb/phone",
                            type: "GET",
                            data: {
                                number: $("#txtnumber").val(),
                                cardid: $("#txtcardid").val()
                            },
                            success: function (result) {

                                //{"number":933955955,"name":"Nguyen thai an","card_id":"031404352","momo":0,"mload":0,"is_reged":true,"is_named":false,"is_actived":true,"is_setup":true,"session_key":"","last_imei":"33F24915-B779-4BF4-8DB7-0441A3A5D1B4","last_time":1419331619458,"pin":"MTIzNDU2","email":"anhongkong@gmail.com","question":"","answer":"","mpt":10,"dob":"","addr":"","otp_time":0,"otp":"","bnk_name":"VietcomBank","bnk_acc":"","bnk_code":"12345","login_cnt":9,"locked_until":0,"del":false,"imei_key":"a45dabf8-42af-4a1b-a95f-d83d19f12174","create_date":1419331380218,"refer_num":0,"iter_cnt":0,"itee_cnt":0,"push_token":"","os":"iOS","isinviter":false,"appVer":"1.9.3","appCode":193,"inviter":"0914863456"}

                                var ndgt = result.arr[0];
                                var ngt = result.arr[1];

                                var r = "<b><u>NGƯỜI ĐƯỢC GIỚI THIỆU</u></b><br>";
                                r += "<b> NUMBER:</b> &nbsp; 0" + ndgt.number;
                                r += "<b> NAME:</b> &nbsp; " + ndgt.name;
                                r += "<b> CMND:</b> &nbsp; " + ndgt.bnk_cardid;
                                r += "<b> Bank code:</b> &nbsp; " + ndgt.bnk_code;
                                r += "<b> Người giới thiệu:</b> &nbsp; " + ndgt.inviter;

                                r += "<br><b><u>NGƯỜI GIỚI THIỆU</u></b><br>";
                                r += "<b> NUMBER:</b> &nbsp; 0" + ngt.number;
                                r += "<b> NAME:</b> &nbsp; " + ngt.name;
                                r += "<b> CMND:</b> &nbsp; " + ngt.bnk_cardid;
                                r += "<b> Bank code:</b> &nbsp; " + ngt.bnk_code;
                                r += "<b> Người giới thiệu:</b> &nbsp; " + ngt.inviter;

                                $("#phone").html(r);

                            },
                            error: function () {
                                alert('Có lỗi kết nối xảy ra');
                            }
                        });

                    }
                    alert(result.desc);
                },
                error: function () {
                    alert('Có lỗi kết nối xảy ra');
                }
            });
        });

        $("#btnSubmit").click(function () {

            //for vcbcmndtb
            $.ajax({
                url: "/vcb/cmnd",
                type: "GET",
                data: {
                    number: $("#txtnumber").val(),
                    cardid: $("#txtcardid").val()
                },
                success: function (result) {
                    //{"_id":"031404352","bnkcode":"12345","timevn":"23/12/2014 17:43:00","number":"0933955955","procnt":0}
                    var r = "";
                    r += "<b> CMND:</b> &nbsp; " + result._id;
                    r += "<b> Bank code:</b> &nbsp; " + result.bnkcode;
                    r += "<b> Time:</b> &nbsp; " + result.timevn;
                    r += "<b> NUMBER:</b> &nbsp; " + result.number;
                    r += "<b> PROMOTED COUNT:</b> &nbsp; " + result.procnt;
                    $("#vcbcmnd").html(r);
                },
                error: function () {
                    alert('Có lỗi kết nối xảy ra');
                }
            });

            //for vcbtb
            $.ajax({
                url: "/vcb/vcb",
                type: "GET",
                data: {
                    number: $("#txtnumber").val(),
                    cardid: $("#txtcardid").val()
                },
                success: function (result) {

                    //{"_id":"d82cbdc8-794d-4452-9ce6-02ee5311bbad","number":913156486,"bnkcode":"12345","time":1418093909330,"timevn":"09/12/2014 09:58:29","vcid":"53b378ee-4f82-47f8-93c1-3ea251843285","partner":"0913156486","cardid":"381329410","tranid":491098251}

                    var r = "";
                    for(i=0;i< result.arr.length; i++){
                        var item = result.arr[i];
                        r += "<b> NUMBER:</b> &nbsp; 0" + item.number;
                        r += "<b> Bank code:</b> &nbsp; " + item.bnkcode;
                        r += "<b> Time:</b> &nbsp; " + item.bnkcode;
                        r += "<b> Partner:</b> &nbsp; " + item.partner;
                        r += "<b> CMND:</b> &nbsp; " + item.cardid;
                        r +="<br>";
                    }

                    $("#vcb").html(r);

                },
                error: function () {
                    alert('Có lỗi kết nối xảy ra');
                }
            });

            //for phone
            $.ajax({
                url: "/vcb/phone",
                type: "GET",
                data: {
                    number: $("#txtnumber").val(),
                    cardid: $("#txtcardid").val()
                },
                success: function (result) {

                    //{"number":933955955,"name":"Nguyen thai an","card_id":"031404352","momo":0,"mload":0,"is_reged":true,"is_named":false,"is_actived":true,"is_setup":true,"session_key":"","last_imei":"33F24915-B779-4BF4-8DB7-0441A3A5D1B4","last_time":1419331619458,"pin":"MTIzNDU2","email":"anhongkong@gmail.com","question":"","answer":"","mpt":10,"dob":"","addr":"","otp_time":0,"otp":"","bnk_name":"VietcomBank","bnk_acc":"","bnk_code":"12345","login_cnt":9,"locked_until":0,"del":false,"imei_key":"a45dabf8-42af-4a1b-a95f-d83d19f12174","create_date":1419331380218,"refer_num":0,"iter_cnt":0,"itee_cnt":0,"push_token":"","os":"iOS","isinviter":false,"appVer":"1.9.3","appCode":193,"inviter":"0914863456"}

                    var ndgt = result.arr[0];
                    var ngt = result.arr[1];

                    var r = "<b><u>NGƯỜI ĐƯỢC GIỚI THIỆU</u></b><br>";
                    r += "<b> NUMBER:</b> &nbsp; 0" + ndgt.number;
                    r += "<b> NAME:</b> &nbsp; " + ndgt.name;
                    r += "<b> CMND:</b> &nbsp; " + ndgt.bnk_cardid;
                    r += "<b> Bank code:</b> &nbsp; " + ndgt.bnk_code;
                    r += "<b> Người giới thiệu:</b> &nbsp; " + ndgt.inviter;

                    r += "<br><b><u>NGƯỜI GIỚI THIỆU</u></b><br>";
                    r += "<b> NUMBER:</b> &nbsp; 0" + ngt.number;
                    r += "<b> NAME:</b> &nbsp; " + ngt.name;
                    r += "<b> CMND:</b> &nbsp; " + ngt.bnk_cardid;
                    r += "<b> Bank code:</b> &nbsp; " + ngt.bnk_code;
                    r += "<b> Người giới thiệu:</b> &nbsp; " + ngt.inviter;

                    $("#phone").html(r);

                },
                error: function () {
                    alert('Có lỗi kết nối xảy ra');
                }
            });
        });
    });
</script>
</body>
</html>