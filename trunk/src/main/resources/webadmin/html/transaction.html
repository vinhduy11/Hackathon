<html>
<head>
    <title>Tran Action Page</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="../css/mask.css" rel="stylesheet" type="text/css" />
    <script src="../js/jquery.1.9.js"></script>
    <script src="../js/session.js"></script>
    <script src="../js/cookie.js"></script>
    <script type="text/javascript" src="../js/mask.js"></script>
</head>
<body>
<div id="mydiv">
    <h2>Tran Action Page</h2>


    <table id="inputform">
        <tr>
            <td>Phone Number:</td>
            <td><input style="width: 400px; font-size:16px; padding: 3px" type="text" id="phone"/></td>
        </tr>
        <tr>
            <td>TranID:</td>
            <td><input style="width: 400px; font-size:16px; padding: 3px" type="text" id="tranid"/></td>
        </tr>
        <tr>
            <td>Action:</td>
            <td>
                <select id="action" style="width: 150px; font-size:16px; padding: 3px">
                    <option>Select Action</option>
                    <option value="commit">Commit</option>
                    <option value="rollback">Rollback</option>
                </select>
            </td>
        </tr>
        <tr>
            <td colspan="2" align="center">
                <input style="width: 100px; font-size:16px; padding: 3px" type="button" value="Submit" id="buttonTS"/>
            </td>
        </tr>
    </table>
    <div id="responseDiv"></div>

</div>


<script type="text/javascript">
    $(document).ready(function () {
        // Gắn sự kiện onclick vào #viewbtn
        if ($.session.get("id")==null) {
            alert("Bạn phải đăng nhập.");
//                $.setCookie("phone",$("#phone").val());
//                $.setCookie("body",$("#body").val());
//                $.setCookie("caption",$("#caption").val());
            $.session.clear();
            window.parent.location.href = "../html/login.html";
        }
        $('#buttonTS').click(function () {
//          $('#loading').html('Processing...');
            $('#mydiv').mask("Loading...");
            $.ajax({
                url: "/tran/do",
                type: "GET",
                data: { phone:$("#phone").val(),
                        tranid:$("#tranid").val(),
                        action:$("#action").val(),
                        id: $.session.get("id"),
                        username:$.session.get("username")
                },
                success: function (string) {
                    $('#mydiv').unmask();
                    var error = string["error"];
                    if (error == 0)
                        alert("Thành công.");
                    else if (error == -1) {
                        alert("Bạn phải đăng nhập.");
                        $.session.clear();
                        window.parent.location.href = "../html/login.html";
                    }
                    else
                        alert("Không thành công. Error code = " + error);
                },
                error: function () {
                    $('#mydiv').unmask();
                    alert('Có lỗi kết nối xảy ra');
                }
            });
        });
    });

</script>
</body>
</html>