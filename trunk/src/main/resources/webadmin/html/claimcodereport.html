<!DOCTYPE html>
<html>
<head>
    <title>Kiểm tra thông tin Claim Code</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="../css/mask.css" rel="stylesheet" type="text/css"/>
    <link href="../css/mycss.css" rel="stylesheet" type="text/css"/>
    <script src="../js/jquery.1.9.js"></script>
    <!--<script src="../js/session.js"></script>-->
    <!--<script src="../js/cookie_OLD.js"></script>-->
    <script type="text/javascript" src="../js/mask.js"></script>
    <link rel="stylesheet" href="../css/jquery.datetimepicker.css" type="text/css"/>
    <script src="../js/jquery.datetimepicker.js"></script>
</head>
<body>
<div>
    <h2>Lấy thông tin imei của số điện thoại</h2>
</div>
<table>
    <tr>
        <td>Nhập số điện thoại:</td>
        <td><input type="text" id="phone_number"/></td>
    </tr>
    <tr>
        <td>Device Imei:</td>
        <td><input type="text" id="last_imei"/></td>
    </tr>
    <tr>
        <td></td>
        <td>
            <button id="btnSearchImei">Search</button>
        </td>
    </tr>
</table>
<div>
    <h2>Kiểm tra thông tin Claim Code</h2>
</div>
<hr/>
<table>
    <tr>
        <td>Chuong trinh:</td>
        <td><input type="text" id="txt_program"/></td>
    </tr>
    <tr>
        <td>Số điện thoại:</td>
        <td><input type="text" id="phonenumber"/></td>
    </tr>
    <tr>
        <td>Device Imei:</td>
        <td><input type="text" id="imei"/></td>
    </tr>
    <tr>
        <td>Code:</td>
        <td><input type="text" id="code"/></td>
    </tr>

    <tr>
        <td></td>
        <td>
            <button id="btnSearch">Search</button>
        </td>
    </tr>
</table>
<hr/>
<table id="table">
</table>
<hr/>


<script type="text/javascript">

    function clearTable() {
        var head = "<tr>";
        head += "<th>So dien thoai</th>";
        head += "<th>Code</th>";
        head += "<th>Thoi gian nhan</th>";
        head += "<th>Device Imei</th>";
        head += "<th>Trang thai</th>";
        head += "<th></th>";
        head += "</tr>";
        $("#table").html(head);
    }

    function addItem(item) {
        var row;
        var time = new Date(item.time);
        var time_money = new Date(item.end_time_money);
        var time_gift = new Date(item.end_time_gift);
        var time_percent = new Date(item.end_bonus_7percent_time);
        row = "<tr>"
        row += "<td> " + item.phone_number + " </td>";
        row += "<td> " + item._id + " </td>";
        row += "<td> " + item.time + " </td>";
        row += "<td> " + item.device_imei + " </td>";
        row += "<td> " + item.money_status + " </td>";
        row += "</tr>";
        $("#table").append(row);
    }

    function loadPage(data) {
        clearTable();
        $.each(data, function (i, item) {
           addItem(item);
        });

    }

    $(document).ready(function () {
        $("#btnSearchImei").click(function () {
            $("#last_imei").val("");
            $.ajax({
            url: "/mLogger",
            type: "GET",
            data: {
                phoneNumber:$("#phone_number").val()
            },
            success: function (data) {
            var lastImei = data["last_imei"];
            $("#last_imei").val(lastImei);
            },
                error: function () {
                    $('#mydiv').unmask();
                    alert('Có lỗi kết nối xảy rsa');
                }
            });
        });

        $("#btnSearch").click(function () {
            $.ajax({
            url: "/searchClaimCodeInfo",
            type: "GET",
            data: {
                code:$("#code").val(),
                phoneNumber:$("#phonenumber").val(),
                imei:$("#imei").val(),
                program:$("#txt_program").val()
            },
            success: function (data) {
                    loadPage(data);
            },
                error: function () {
                    $('#mydiv').unmask();
                    alert('Có lỗi kết nối xảy rsa');
                }
            });
        });

    });
</script>
</body>
</html>