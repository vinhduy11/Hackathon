<!DOCTYPE html>
<html>
<head>
    <title>Service category</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="/css/mask.css" rel="stylesheet" type="text/css"/>
    <link href="/css/mycss.css" rel="stylesheet" type="text/css"/>
    <script src="/js/jquery.1.9.js"></script>

    <script type="text/javascript" src="/js/mask.js"></script>
    <link rel="stylesheet" href="/css/jquery.datetimepicker.css" type="text/css"/>
    <script src="/js/jquery.datetimepicker.js"></script>
    <script src="/js/myjs.js"></script>


</head>
<body>

<div>
    <h2>Error Code Management</h2>
    <div class="clear"></div>
    <hr />
    <table id="table">

    </table>
    <hr />
</div>
<hr />
<table>
    <tr>
        <td>Error Code : </td>
        <td><input type="text" id="error_code" name="error_code"/></td>
    </tr>
    <tr>
        <td>Description:</td>
        <td><input type="text" id="description" name="description"/></td>
    </tr>


    <tr>
        <td></td>
        <td>
            <button id="btnClear">Clear</button>
            <button id="btnSave">Save</button>
        </td>
    </tr>
</table>

<script type="text/javascript">

    function clearTable() {
        var head = "<tr>";
        head += "<th>Action</th>";
        head += "<th>Error Code</th>";
        head += "<th>Description</th>";
        head +="</tr>";
        $("#table").html(head);
    }

    function addItem(item) {
        var row;
        var editButton = "<button id='edit_" + item.error_code + "'>Edit</button>";
        var delButton = "<button id='del_" + item.error_code + "'>Del</button>";
        row = "<tr id='r_" + item.error_code + "'>";
        row += "<td> " + editButton  +" </td>";
        row += "<td> " + item.error_code + " </td>";
        row += "<td> " + item.description + " </td>";
        row += "</tr>";

        $("#table").append(row);
//        $("#del_" + item.error_code).click(function () {
//            $.ajax({
//                url: "/ErrCode/del?error_code="+item.error_code,
//                type: "GET",
//                enctype: "multipart/form-data",
//                data: {
//                    error_code:$(item.error_code).val(),
//                },
//                success: function (result) {
//                    var error = result.error;
//                    if (error == 0) {
//                        alert("Thành công.");
//                        loadPage()
//                    }
//                    else
//                        alert(result.error_code);
//                },
//                error: function () {
//                    alert('Có lỗi kết nối xảy ra');
//                }
//            });
//        });
//
        $("#edit_" + item.error_code).click(function () {
            setFormValues(item);
        });
    }



    function setFormValues(item) {
        $("#error_code").val(item.error_code);
        $("#description").val(item.description);
    }
    function loadPage() {
        clearTable();
        var mUrl = "/ErrCode/getall";
        $.getJSON(mUrl).done(function (data) {
            $.each(data, function (i, item) {
                addItem(item);
            });
        });
    }
    function resetVal(){
        $("#error_code").val("");
        $("#description").val("");
    }
    $(document).ready(function () {
        loadPage();

        $("#btnSave").click(function () {
            $.ajax({
                url: "/ErrCode/upsert",
                type: "GET",
                enctype: "multipart/form-data",
                data: {
                    error_code:$("#error_code").val(),
                    description:$("#description").val(),
                },
                success: function (result) {
                    var error = result.error;
                    if (error == 0) {
                        alert("Thành công.");
                        loadPage()
                    }
                    else
                        alert(result.description);
                }

            });
        });

    });
    $('#btnReload').click(function () {
        reload();
    });
    $('#btnClear').click(function () {
        resetVal();
    });

    function reload(){
        $.ajax({
            url: "/servicecate/reload",
            type: "GET",
            success: function (string) {
                $('#mydiv').unmask();
                var error = string["error"];
                if (error == 0) {
                    alert("Thành công.");
                }
                else if (error == -1) {
                    alert("Bạn phải đăng nhập.");
                    $.session.clear();
                    window.parent.location.href = "../html/login.html";
                }
                else
                    alert("Không thành công. Error code = " + error);
            },
            error: function () {
                $('#mydiv').unmask();
                alert('Có lỗi kết nối xảy ra');
            }
        });


    }
</script>
</body>
</html>